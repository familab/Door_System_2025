title: "FamiLAB Door Controller - Raspberry Pi Zero W Wiring"
# Wiring diagram for the FamiLAB Door Controller. Components:
# - Raspberry Pi Zero W (40-pin header)
# - PN532 RFID Reader (I2C)
# - 12V Relay module (controlled by GPIO)
# - 12V â†’ 5V buck converter
# - 12V door latch (powered via relay)
# - 12V power supply
# - 2 x Push buttons (unlock, lock)
# - 3D printed enclosure (mechanical)
# Pi Zero W shares the same 40-pin GPIO header as Pi 4; pinviz uses the `raspberry_pi_4` board template
board: "raspberry_pi_4"

devices:
  - type: "i2c_device"
    name: "PN532 NFC Reader"

  - type: "led"
    name: "Relay Module"

  - type: "button"
    name: "Unlock Button"

  - type: "button"
    name: "Lock Button"

connections:
  # PN532 NFC Reader (I2C)
  - board_pin: 1       # 3V3 Power
    device: "PN532 NFC Reader"
    device_pin: "VCC"

  - board_pin: 6       # GND
    device: "PN532 NFC Reader"
    device_pin: "GND"

  - board_pin: 3       # GPIO2 (I2C SDA)
    device: "PN532 NFC Reader"
    device_pin: "SDA"

  - board_pin: 5       # GPIO3 (I2C SCL)
    device: "PN532 NFC Reader"
    device_pin: "SCL"

  # Relay Module (GPIO 17 = physical pin 11)
  - board_pin: 11      # GPIO17 - Relay control signal
    device: "Relay Module"
    device_pin: "+"

  - board_pin: 9       # GND
    device: "Relay Module"
    device_pin: "-"

  # Unlock Button (GPIO 27 = physical pin 13)
  - board_pin: 13      # GPIO27
    device: "Unlock Button"
    device_pin: "SIG"

  - board_pin: 14      # GND
    device: "Unlock Button"
    device_pin: "GND"

  # Lock Button (GPIO 22 = physical pin 15)
  - board_pin: 15      # GPIO22
    device: "Lock Button"
    device_pin: "SIG"

  - board_pin: 20      # GND
    device: "Lock Button"
    device_pin: "GND"

# Notes (moved to comments because top-level 'notes' is not supported by PinViz schema):
# CONFIG:
#   RELAY_PIN: 17  # Relay control pin for the door latch
#   BUTTON_UNLOCK_PIN: 27  # Unlock button pin
#   BUTTON_LOCK_PIN: 22  # Lock button pin
#
# EXAMPLE CODE:
#   import RPi.GPIO as GPIO
#   GPIO.setmode(GPIO.BCM)
#   GPIO.setup(RELAY_PIN, GPIO.OUT)
#   GPIO.setup(BUTTON_UNLOCK_PIN, GPIO.IN, pull_up_down=GPIO.PUD_UP)
#   GPIO.setup(BUTTON_LOCK_PIN, GPIO.IN, pull_up_down=GPIO.PUD_UP)
#
#   # Initially, keep the relay off (door locked)
#   GPIO.output(RELAY_PIN, GPIO.LOW)
#
#   import busio, board
#   from adafruit_pn532.i2c import PN532_I2C
#   i2c = busio.I2C(board.SCL, board.SDA)
#   pn532 = PN532_I2C(i2c, debug=False)
#   pn532.SAM_configuration()
#   logger.info("PN532 RFID reader initialized")
#
# POWER NOTES:
#   - Relay switches 12V from the power supply to the door latch.
#   - Buck converter can supply 5V/3.3V as needed for peripherals.
